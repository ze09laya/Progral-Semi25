<form id="frmBusquedaCliente">
    <style>
        #frmBusquedaCliente {
            font-family: "Segoe UI", Arial, sans-serif;
            font-size: 0.87rem;
        }

            #frmBusquedaCliente .card {
                border: none !important;
                background: #1f1f1f;
                border-radius: 18px;
                box-shadow: 0 6px 24px rgba(0,0,0,0.4);
            }

            #frmBusquedaCliente .card-header {
                background: linear-gradient(90deg, #9bbfa9, #85b59b);
                border-radius: 18px 18px 0 0;
                font-size: 1.1rem;
                color: #172820;
                font-weight: 600;
                padding: 14px 18px;
            }

            #frmBusquedaCliente .btn-close {
                filter: invert(0%);
            }

                #frmBusquedaCliente .btn-close:hover {
                    opacity: 1;
                }

            #frmBusquedaCliente table {
                color: #d7e8df;
            }

            #frmBusquedaCliente th {
                color: #b7d2c3;
                font-weight: 600;
                background-color: #2b2b2b !important;
                border-bottom: 2px solid #3d3d3d;
            }

            #frmBusquedaCliente tbody tr {
                background: #262626;
                cursor: pointer;
                transition: 0.2s;
            }

                #frmBusquedaCliente tbody tr:hover {
                    background: #2f3c34;
                }

            #frmBusquedaCliente input[type="search"] {
                background: #2b2b2b;
                border: 1px solid #6f9c85;
                color: #d3e5da;
                border-radius: 10px;
                padding-left: 10px;
                transition: 0.2s;
            }

                #frmBusquedaCliente input[type="search"]:focus {
                    border-color: #8cc7a7;
                    box-shadow: 0 0 6px rgba(140,199,167,0.4);
                }

            #frmBusquedaCliente .btn-outline-danger {
                border-color: #d98a8a;
                color: #e69c9c;
            }

                #frmBusquedaCliente .btn-outline-danger:hover {
                    background: #e69c9c;
                    color: #1f1f1f;
                }
    </style>

    <div class="card border-secondary mb-3" style="min-width: 700px;">
        <div class="card-header">
            <div class="d-flex">
                Consulta de Clientes
                <div class="ms-auto">
                    <button data-form="busqueda_cliente" type="button" class="btn-close" aria-label="Close"
                            onclick="cerrarFormulario('frmbusqueda_cliente')"></button>
                </div>
            </div>
        </div>

        <div class="card-body text-secondary">
            <table id="tblConsultaClientes" class="table">
                <thead>
                    <tr>
                        <th colspan="6">
                            <input id="txtBuscarCliente" type="search" class="form-control"
                                   placeholder="Buscar clientes por documento, nombre">
                        </th>
                    </tr>
                    <tr>
                        <th>DOCUMENTO</th>
                        <th>NOMBRE</th>
                        <th>CORREO</th>
                        <th>ESTADO</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</form>

<script>
    listarClientes();

    document.getElementById("txtBuscarCliente").addEventListener("keyup", e => {
        listarClientes(e.target.value);
    });

    async function listarClientes(buscar = '') {
        const respuesta = await fetch(`https://localhost:7240/api/Clientes/buscar?buscar=${buscar}`, {
            method: 'GET',
            headers: { "Content-Type": "application/json" }
        });

        const clientes = await respuesta.json();
        let filas = '';

        clientes.forEach(cliente => {
            filas += `
            <tr onclick='modificarCliente(${JSON.stringify(cliente)})'>
                <td>${cliente.documento}</td>
                <td>${cliente.nombre_Completo}</td>
                <td>${cliente.correo}</td>
                <td>${cliente.estado ? 'Activo' : 'Inactivo'}</td>
                <td>
                    <button type="button" class="btn btn-outline-danger btn-sm"
                        onclick='eliminarCliente(${JSON.stringify(cliente)}, event)'>
                        DEL
                    </button>
                </td>
            </tr>
        `;
        });

        document.querySelector("#tblConsultaClientes tbody").innerHTML = filas;
    }

    async function eliminarCliente(cliente, event) {
        event.stopPropagation();
        event.preventDefault();

        if (!confirm(`¿Está seguro de eliminar al cliente ${cliente.nombre_Completo}?`)) return;

        const respuesta = await fetch(`https://localhost:7240/api/Clientes/${cliente.idCliente}`, {
            method: 'DELETE',
            headers: { "Content-Type": "application/json" }
        });

        const data = await respuesta.text();

        if (data && data.length > 0) {
            alert(`Error al eliminar cliente: ${data}`);
            return;
        }

        listarClientes();
    }

    function cerrarFormulario(id) {
        document.getElementById(id).style.display = "none";
    }
</script>
